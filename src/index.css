@tailwind base;
@tailwind components;
@tailwind utilities;

/* CSS Custom Properties for Safe Areas */
:root {
  --safe-top: env(safe-area-inset-top);
  --safe-bot: env(safe-area-inset-bottom);
  --safe-left: env(safe-area-inset-left);
  --safe-right: env(safe-area-inset-right);
}

/* Base Styles */
html, body, #root { 
  height: 100%; 
  margin: 0; 
  padding: 0;
  overflow-x: hidden;
}

/* Ensure full height layout */
.min-h-screen {
  min-height: 100vh;
}

html {
  background: #111827;
  font-size: 16px; /* Prevent iOS zoom on input focus */
}

body { 
  background: #111827;
  font-family: 'Inter', sans-serif;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  padding: 0;
  margin: 0;
  height: 100%;
  min-height: 100vh;
  overflow-x: hidden;
}

/* Safe area utility classes */
.safe-top { padding-top: var(--safe-top); }
.safe-bottom { padding-bottom: var(--safe-bot); }
.safe-left { padding-left: var(--safe-left); }
.safe-right { padding-right: var(--safe-right); }
.safe-x { padding-left: var(--safe-left); padding-right: var(--safe-right); }
.safe-y { padding-top: var(--safe-top); padding-bottom: var(--safe-bot); }

/* Mobile-first responsive design */
@media (max-width: 1023px) {
  /* Mobile sidebar */
  .sidebar {
    transform: translateX(-100%);
    position: fixed;
    top: 0;
    left: 0;
    height: 100vh;
    width: 256px;
    max-width: 85vw;
    z-index: 50;
    background-color: #1f2937;
    border-right: 1px solid #374151;
  }
  
  .sidebar.open {
    transform: translateX(0);
  }
  
  /* Mobile menu header with Dynamic Island spacing */
  .sidebar .header {
    padding-top: calc(1rem + env(safe-area-inset-top) + 0.5rem);
    min-height: calc(80px + env(safe-area-inset-top) + 0.5rem);
  }
  
  /* Mobile navigation with proper spacing */
  .sidebar nav {
    padding-top: 1rem;
    height: calc(100vh - 80px - env(safe-area-inset-top) - 0.5rem);
  }
  
  /* Main content on mobile */
  .main-content {
    width: 100%;
    margin-left: 0;
    padding: 1rem;
    padding-top: calc(80px + var(--safe-top) + 0.5rem);
    padding-bottom: calc(1rem + var(--safe-bot));
    padding-left: calc(1rem + var(--safe-left));
    padding-right: calc(1rem + var(--safe-right));
  }
  
  /* Mobile grid - single column */
  .grid {
    display: grid;
    grid-template-columns: 1fr;
    gap: 1rem;
  }
  
  /* Mobile cards */
  .ghost-card {
    width: 100%;
    max-width: 100%;
    margin: 0 0 1rem 0;
    padding: 1rem;
  }
  
  /* Mobile buttons */
  button, .btn, input, select, textarea {
    min-height: 44px;
    font-size: 16px;
  }
  
  /* Mobile typography */
  h1 { font-size: 1.5rem; }
  h2 { font-size: 1.25rem; }
  h3 { font-size: 1.125rem; }
  
  /* Mobile spacing */
  .space-y-4 > * + * { margin-top: 1rem; }
  .space-y-6 > * + * { margin-top: 1.5rem; }
  .space-y-8 > * + * { margin-top: 2rem; }
}

/* Desktop styles */
@media (min-width: 1024px) {
  .sidebar {
    transform: translateX(0);
    position: fixed;
    top: 0;
    left: 0;
    height: 100vh;
    min-height: 100vh;
    width: 256px;
    z-index: 40;
    background-color: #1f2937;
    border-right: 1px solid #374151;
  }
  
  /* Ensure sidebar background extends full page height */
  body {
    background-color: #1f2937;
  }
  
  /* Main content area background */
  .main-content {
    background-color: #111827;
  }
  
  .main-content {
    padding: 1.5rem !important;
    padding-top: 1.5rem !important;
    padding-bottom: calc(1.5rem + var(--safe-bot)) !important;
    padding-left: calc(1.5rem + var(--safe-left)) !important;
    padding-right: calc(1.5rem + var(--safe-right)) !important;
  }
  
  .grid {
    display: grid;
    gap: 1.5rem;
  }
  
  .grid-cols-1 { grid-template-columns: repeat(1, minmax(0, 1fr)); }
  .grid-cols-2 { grid-template-columns: repeat(2, minmax(0, 1fr)); }
  .grid-cols-3 { grid-template-columns: repeat(3, minmax(0, 1fr)); }
  .grid-cols-4 { grid-template-columns: repeat(4, minmax(0, 1fr)); }
}

/* Component styles */
@layer components {
  .ghost-card {
    @apply bg-gray-800 border border-gray-700 rounded-xl shadow-lg backdrop-blur-sm;
  }
  
  .ghost-button {
    @apply bg-green-500 hover:bg-green-400 text-black font-medium py-2 px-4 rounded-lg transition-all duration-200 hover:shadow-lg hover:shadow-green-500/25;
  }
  
  .ghost-button-secondary {
    @apply bg-gray-700 hover:bg-gray-600 text-white font-medium py-2 px-4 rounded-lg transition-all duration-200 border border-gray-600;
  }
  
  .ghost-input {
    @apply bg-gray-800 border border-gray-600 rounded-lg px-3 py-2 text-white placeholder-gray-400 focus:border-green-500 focus:ring-1 focus:ring-green-500 transition-colors;
  }
  
  .ghost-select {
    @apply bg-gray-800 border border-gray-600 rounded-lg px-3 py-2 text-white focus:border-green-500 focus:ring-1 focus:ring-green-500 transition-colors;
  }

  /* Enhanced SearchableDropdown styles */
  .searchable-dropdown {
    @apply relative;
  }

  .searchable-dropdown-label {
    @apply block text-sm font-medium text-gray-300 mb-2;
  }

  .searchable-dropdown-input {
    @apply w-full py-3 pr-10 bg-gray-800 border border-gray-600 rounded-lg text-base min-h-[48px] transition-all duration-200 ease-in-out focus:outline-none focus:border-green-500 focus:ring-2 focus:ring-green-500/20 disabled:bg-gray-700 disabled:text-gray-400 disabled:cursor-not-allowed disabled:border-gray-700 hover:border-gray-500 hover:bg-gray-750;
  }

  .searchable-dropdown-portal {
    @apply fixed bg-gray-800 border border-gray-600 rounded-xl shadow-2xl z-[99999] backdrop-blur-sm transition-all duration-200 ease-out;
  }

  .searchable-dropdown-option {
    @apply px-4 py-3 text-base cursor-pointer transition-all duration-200 min-h-[48px] flex items-center relative group hover:bg-gray-700 hover:text-white active:bg-gray-600 focus:outline-none focus:bg-gray-700 focus:ring-2 focus:ring-green-500/20;
  }

  .searchable-dropdown-option-selected {
    @apply bg-green-900/30 text-green-400 border-l-4 border-green-500;
  }

  .searchable-dropdown-option-highlighted {
    @apply bg-green-500 text-black font-medium;
  }

  .searchable-dropdown-option-disabled {
    @apply text-gray-500 cursor-not-allowed opacity-60;
  }
}

/* Mobile-specific improvements */
@media (max-width: 430px) {
  /* Force single column on very small screens */
  .grid-cols-1,
  .grid-cols-2,
  .grid-cols-3,
  .grid-cols-4,
  .sm\\:grid-cols-2,
  .sm\\:grid-cols-3,
  .md\\:grid-cols-2,
  .md\\:grid-cols-3,
  .md\\:grid-cols-4,
  .lg\\:grid-cols-2,
  .lg\\:grid-cols-3,
  .lg\\:grid-cols-4 {
    grid-template-columns: 1fr !important;
  }
  
  /* Mobile cards */
  .ghost-card {
    padding: 1rem;
    margin-bottom: 1rem;
    width: 100%;
    max-width: 100%;
  }
  
  /* Mobile buttons */
  .ghost-button, .ghost-button-secondary {
    min-height: 44px;
    padding: 12px 16px;
    font-size: 16px;
    width: 100%;
    justify-content: center;
  }
  
  /* Mobile forms */
  .ghost-input, .ghost-select {
    min-height: 44px;
    font-size: 16px;
    padding: 12px 16px;
    width: 100%;
  }

  /* Enhanced mobile SearchableDropdown */
  .searchable-dropdown-input {
    min-height: 48px;
    font-size: 16px;
    padding: 12px 16px;
  }

  .searchable-dropdown-option {
    min-height: 52px;
    padding: 14px 16px;
    font-size: 16px;
  }

  .searchable-dropdown-portal {
    max-height: 60vh;
    border-radius: 16px;
  }
  
  /* Mobile typography */
  body {
    font-size: 16px;
  }
  
  h1 { font-size: 1.5rem; line-height: 1.2; }
  h2 { font-size: 1.25rem; line-height: 1.3; }
  h3 { font-size: 1.125rem; line-height: 1.4; }
  
  /* Mobile spacing */
  .space-y-4 > * + * { margin-top: 1rem; }
  .space-y-6 > * + * { margin-top: 1.5rem; }
  .space-y-8 > * + * { margin-top: 2rem; }
  
  /* Mobile modals */
  .modal-content {
    max-width: 95vw;
    margin: 1rem;
    border-radius: 12px;
  }
}

/* Enhanced SearchableDropdown mobile responsiveness */
@media (max-width: 768px) {
  .searchable-dropdown-portal {
    left: 16px !important;
    right: 16px !important;
    width: calc(100vw - 32px) !important;
    max-height: 60vh;
  }

  .searchable-dropdown-option {
    min-height: 48px;
    padding: 12px 16px;
  }

  .searchable-dropdown-input {
    min-height: 48px;
    padding: 12px 16px;
  }
}

/* Toast System */
#toast-container {
  position: fixed; 
  left: 50%; 
  bottom: calc(16px + var(--safe-bot));
  transform: translateX(-50%);
  display: flex; 
  flex-direction: column; 
  gap: 8px; 
  z-index: 9999;
  pointer-events: none;
  max-width: calc(100vw - var(--safe-left) - var(--safe-right) - 32px);
}

.toast {
  pointer-events: auto;
  max-width: min(90vw, 420px);
  padding: 12px 14px; 
  border-radius: 12px;
  background: rgba(0,0,0,0.85); 
  color: #fff; 
  font-size: 14px; 
  line-height: 1.3;
  box-shadow: 0 8px 24px rgba(0,0,0,0.25);
  animation: fadeIn .2s ease;
}

@keyframes fadeIn { 
  from { 
    opacity: 0; 
    transform: translate(-50%, 8px);
  } 
  to { 
    opacity: 1; 
    transform: translate(-50%, 0);
  } 
}

/* Focus styles for accessibility */
button:focus-visible, 
.btn:focus-visible, 
input:focus-visible, 
select:focus-visible, 
textarea:focus-visible {
  outline: 2px solid #3b82f6;
  outline-offset: 2px;
}

/* Touch-friendly interactions */
button, .btn, input, select, textarea, [role="button"] {
  -webkit-tap-highlight-color: rgba(0,0,0,0.1);
  touch-action: manipulation;
}

/* Prevent horizontal overflow */
* {
  max-width: 100%;
}

/* Responsive images */
img, video, canvas, svg { 
  max-width: 100%; 
  height: auto; 
}

/* Dynamic Island specific handling */
@supports (padding: env(safe-area-inset-top)) {
  /* For devices with Dynamic Island (iPhone 14 Pro and newer) */
  @media (max-width: 1023px) {
    .sidebar .header {
      padding-top: max(calc(1rem + env(safe-area-inset-top) + 0.5rem), calc(1rem + 44px + 0.5rem));
    }
    
    .main-content {
      padding-top: max(calc(80px + var(--safe-top) + 0.5rem), calc(80px + 44px + 0.5rem));
    }
    
    .mobile-menu-button {
      top: max(calc(1rem + env(safe-area-inset-top) + 0.5rem), calc(1rem + 44px + 0.5rem)) !important;
    }
  }
}

/* Fallback for devices without safe-area-inset support */
@supports not (padding: env(safe-area-inset-top)) {
  :root {
    --safe-top: 44px; /* Increased for Dynamic Island area */
    --safe-bot: 0px;
    --safe-left: 0px;
    --safe-right: 0px;
  }
  
  @media (max-width: 1023px) {
    .sidebar .header {
      padding-top: calc(1rem + 44px + 0.5rem);
    }
    
    .main-content {
      padding-top: calc(80px + 44px + 0.5rem);
    }
    
    .mobile-menu-button {
      top: calc(1rem + 44px + 0.5rem) !important;
    }
  }
}